<template>
    <template if:false={isSaved}>
    <!-- Card for Funder Costing Details -->
    <div class="funderDetails">
    <lightning-card >
        
        <!-- Funder Costing Details with Updated Background -->
<div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_large" 
style="border: 2px solid #FF6F61; border-radius: 10px; background-color: #faf7f7;"> 
<div class="slds-grid slds-grid_align-center slds-m-bottom_small">
   <!-- Icon -->
   <div class="slds-icon_container slds-icon-custom-custom9 slds-m-right_x-small" style="color: #FF6F61;">
       <svg class="slds-icon slds-icon_medium" aria-hidden="true">
           <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#moneybag"></use>
       </svg>
   </div>
   <!-- Title -->
   <h1 class="slds-text-heading_large slds-text-color_success" style="font-weight: bold; color: #83e94c;">
       Funder Costing Details
   </h1>
</div>
<!-- Content -->
<p class="slds-text-body_regular" style="font-size: 1.4rem; text-align: center; color: #333;">
   Manage and review your funder costing details effectively.
</p>
</div>

        
        
        
        
        <template if:true={costingDetails}>
            <div class="slds-grid slds-wrap slds-p-around_small">
                <!-- Normal Bead -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Normal Bead" 
                        data-field="Normal_Bead__c" 
                        onchange={handleNormalBeadChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Normal_Bead__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Normal_Bead__c}
                        </span>
                    </template>
                </div>
            
                <!-- Innovation Bead -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Innovation Bead" 
                        data-field="Innovation_Bead__c" 
                        onchange={handleInnovationBeadChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Innovation_Bead__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Innovation_Bead__c}
                        </span>
                    </template>
                </div>
            
                <!-- RIR -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="RIR" 
                        data-field="RIR__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.RIR__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.RIR__c}
                        </span>
                    </template>
                </div>
            
                <!-- Loft -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Loft" 
                        data-field="Loft__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Loft__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Loft__c}
                        </span>
                    </template>
                </div>
            
                <!-- Mechanical Vents -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Mechanical Vents" 
                        data-field="Mechanical_Vents__c" 
                        onchange={handleMechanicalVentsChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Mechanical_Vents__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Mechanical_Vents__c}
                        </span>
                    </template>
                </div>
            
                <!-- EPR Fee -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="EPR Fee" 
                        data-field="EPR_fee__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.EPR_fee__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.EPR_fee__c}
                        </span>
                    </template>
                </div>
            
                <!-- EPC Elmhurst -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="EPC Elmhurst" 
                        data-field="EPC_Elmhurst__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.EPC_Elmhurst__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.EPC_Elmhurst__c}
                        </span>
                    </template>
                </div>
            
                <!-- TM Lodgement -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="TM Lodgement" 
                        data-field="TM_Lodgement__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.TM_Lodgement__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.TM_Lodgement__c}
                        </span>
                    </template>
                </div>
            
                <!-- TM Amendment -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="TM Amendment" 
                        data-field="TM_Amendment__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.TM_Amendment__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.TM_Amendment__c}
                        </span>
                    </template>
                </div>
            
                <!-- Survey Fee -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Survey Fee" 
                        data-field="Survey_Fee__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Survey_Fee__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Survey_Fee__c}
                        </span>
                    </template>
                </div>
            
                <!-- Tech Survey -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Tech Survey" 
                        data-field="Tech_Survey__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Tech_Survey__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Tech_Survey__c}
                        </span>
                    </template>
                </div>
            
                <!-- Retrofit Coordination -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Retrofit Coordination" 
                        data-field="Retrofit_Coodintation__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Retrofit_Coodintation__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Retrofit_Coodintation__c}
                        </span>
                    </template>
                </div>
            
                <!-- Land Registry -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="Land Registry" 
                        data-field="Land_Registry__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.Land_Registry__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.Land_Registry__c}
                        </span>
                    </template>
                </div>
            
                <!-- CIGA Search -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 12px; border-radius: 12px; background: linear-gradient(135deg, #E0F7FA, #80DEEA); 
                    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <lightning-input 
                        type="checkbox" 
                        label="CIGA Search" 
                        data-field="CIGA_Search__c" 
                        onchange={handleCheckboxChange} 
                        style="font-weight: bold; font-size: 1.4rem; color: #00796B;">
                    </lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small slds-box slds-theme_default" 
                    style="padding: 8px; border-radius: 10px; background: linear-gradient(135deg, #F1F8E9, #AED581); 
                    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15); font-size: 1.2rem; text-align: center;">
                    <template if:true={fieldVisibility.CIGA_Search__c}>
                        <span class="field-value" 
                            style="font-weight: bold; color: #388E3C; padding: 5px 12px; border-radius: 5px; 
                            background-color: #DCEDC8; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                            {costingDetails.CIGA_Search__c}
                        </span>
                    </template>
                </div>
            </div>
             
        </template>

        <template if:true={error}>
            <p>Error loading Funder Costing Details</p>
        </template>
    </lightning-card>
</div>
    <!-- Funder List and Summary Card -->
    <lightning-card >

      <!-- Funder List with Enhanced Background and Shades -->
            <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_large" 
            style="border: 2px solid #5DADE2; border-radius: 10px; background: linear-gradient(135deg, #EBF5FB 0%, #AED6F1 100%);"> 
            <div class="slds-grid slds-grid_align-center slds-m-bottom_small">
            <!-- Icon -->
            <div class="slds-icon_container slds-icon-custom-custom63 slds-m-right_x-small" style="color: #2E86C1;">
                <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                    <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#diamond"></use>
                </svg>
            </div>
            <!-- Title -->
            <h2 class="slds-text-heading_medium slds-text-color_default" style="font-size: 2rem; font-weight: bold; color: #1A5276;">
                Funder List
            </h2>
            </div>
            <!-- Content -->
            <p class="slds-text-body_regular" style="font-size: 1.2rem; text-align: center; color: #34495E;">
            Here you can review the list of available funders.
            </p>
            </div>


        
        <template if:true={funders.length}>
            <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                <thead>
                    <tr class="slds-text-title_caps">
                        <th scope="col">
                            <div class="slds-truncate" title="Funder Name">Funder Name</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Funder Price">Funder Price</div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={funders} for:item="funder">
                        <tr key={funder.name}>
                            <td data-label="Funder Name">
                                <span>{funder.name}</span>
                            </td>
                            <td data-label="Funder Price">
                                <span>{funder.price}</span>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </template>

        <template if:false={funders.length}>
            <p>No funders available</p>
        </template>

        <!-- Funder Details Section -->
            <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_small" 
                    style="border: 2px solid #58D68D; border-radius: 10px; background: linear-gradient(135deg, #E8F8F5 0%, #58D68D 100%);"> 
                <h3 class="slds-text-heading_medium slds-text-color_success slds-text-align_center" 
                    style="font-size: 2rem; font-weight: bold; color: #1D8348;">
                    <span class="slds-icon_container slds-icon-custom-custom63 slds-m-right_x-small" title="Calculation">
                        <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#calculator"></use>
                        </svg>
                    </span>
                    Costing and Profit Breakdown
                </h3>
            </div>


            <div class="funderDetails">
        <div class="slds-grid slds-wrap slds-p-around_small">
            <!-- Funder Average Price -->
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <strong>Funder average price:</strong>
            </div>
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <span>{funderAveragePrice}</span>
            </div>

            <!-- ABS Costing -->
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <strong>ABS Costing:</strong>
            </div>
            <!-- abs costing -->

            <template if:true={showLoading}>
                <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
            </template>
        
            <template if:true={showError}>
                <div class="slds-box slds-theme_error">
                    <p>Error loading SAP Band and Cost Savings: {errorMessage}</p>
                    <lightning-button label="Retry" onclick={handleRetry} variant="brand"></lightning-button>
                </div>
            </template>
        
            <template if:true={showData}>
                <div class="slds-box slds-p-around_medium" 
                     style="background: linear-gradient(135deg, #FFDEE9, #B5FFFC); border-radius: 15px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); color: #333;">
                    <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                        <strong>Current SAP Band:</strong> {currentSAPBand}
                    </p>
                    <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                        <strong>Potential SAP Band:</strong> {potentialSAPBand}
                    </p>
                    <br>
                    <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                        <strong>Abs Costing:</strong> {costSavings}
                    </p>
                </div>
            </template>
            

            <!-- <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <span>{costSavings}</span>
            </div> -->

            <!-- Profit Bar -->
            <hr>

            <!-- Price We Get -->
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <strong>Price We Get:</strong>
            </div>
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <span>{priceWeGet}</span>
            </div>

            <!-- Total Cost -->
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <strong>Total Cost:</strong>
            </div>
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <span>{totalCost}</span>
            </div>

            <!-- Profit Amount -->
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <strong>Profit Amount:</strong>
            </div>
            <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                <span>{profitAmount}</span>
            </div>

           
            <!-- update percentage bar -->

            
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <p>Profit Percent :</p>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <!-- Progress bar container -->
                    <div class="progress-container">
                        <!-- Progress bar, style dynamically applied based on percentageClass and percentageWidth -->
                        <div class={percentageClass} style="width: {percentageWidth};">
                            {profitPercentage} %
                        </div>
                    </div>
                </div>
            

        </div>
    </div>
        <!-- <div class="slds-col slds-size_1-of-1 slds-p-bottom_x-small">
            <div class="profit-bar" style="width: {profitBarWidth}; background-color: {profitBarColor}; height: 20px;"></div>
        </div> -->
        
        
        

        <!-- Save and Previous Buttons -->
         <div class="funderButton">
            <lightning-card class="slds-p-around_medium slds-m-around_medium" style="background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);">
                <div class="slds-grid slds-grid_align-end">
                    <lightning-button label="SAVE" variant="brand" style="font-size: 1.3rem; padding: 1rem 2.5rem; background-color: white; color: #a6c1ee; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);" onclick={handleSave}></lightning-button>
                </div>
            </lightning-card>
</div>

        
    </lightning-card>
</template>

 


    <!-- Display Summary if isSummary is true -->
    <template if:true={isSummary} >
        
        <lightning-card>
            
            <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_large" style="border: 2px solid #4BCA81; border-radius: 10px; background-color: #f4f6f9;">
                <div class="slds-grid slds-grid_align-center slds-m-bottom_small">
                    <!-- Icon -->
                    <div class="slds-icon_container slds-icon-custom-custom54 slds-m-right_x-small" style="color: #4BCA81;">
                        <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                            <use xlink:href="/assets/icons/custom-sprite/svg/symbols.svg#custom54"></use>
                        </svg>
                    </div>
                    <!-- Title -->
                    <h3 class="slds-text-heading_large slds-text-color_success" style="font-weight: bold;">
                        Costing has already been done
                    </h3>
                </div>
                <!-- Content -->
                <p class="slds-text-body_regular" style="font-size: 1.4rem; text-align: center; color: #333;">
                    Please click on "<strong>EDIT</strong>" to continue.
                    <br />
                    Here are the values that were previously selected from the costing.
                </p>
            </div>
            
            
        
                <!-- Summary of fields -->
                 <!-- Show loading spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading"></lightning-spinner>
        </template>
        <lightning-button class ="slds-float_right " label="Refresh" onclick={refreshCostingData}></lightning-button>
        <br><br>
        <!-- Show costing records once loaded -->
        <template if:true={costingRecords}>
            <div class="slds-grid slds-align_absolute-center slds-m-around_medium">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                <thead>
                    <tr>
                        <th>Field</th>
                        <template for:each={costingRecords} for:item="record">
                            <!-- Use only record.Id as key -->
                            <th key={record.Id}>{record.Name}</th>
                        </template>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Normal Bead</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Normal_Bead__c}</td>
                        </template>
                    </tr>
                    <tr>
                        <th>Innovation Bead</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Innovation_Bead__c}</td>
                        </template>
                    </tr>
                    <tr>
                        <th>RIR</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.RIR__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>Loft</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Loft__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>Mechanical Vents</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Mechanical_Vents__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>EPR Fee</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.EPR_fee__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>EPC Elmhurst</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.EPC_Elmhurst__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>TM Lodgement</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.TM_Lodgement__c}</td>
                        </template>
                    </tr>

                    
                    <tr>
                        <th>TM Amendment</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.TM_Amendment__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>Survey Fee</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Survey_Fee__c}</td>
                        </template>
                    </tr>
                    <tr>
                        <th>Tech Survey</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Tech_Survey__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>Retrofit Coordination</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Retrofit_Coodintation__c}	</td>
                        </template>
                    </tr>
                    
                    <tr>
                        <th>Land Registry</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Land_Registry__c}</td>
                        </template>
                    </tr>

                    <tr>
                        <th>CIGA Search</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.CIGA_Search__c}</td>
                        </template>
                    </tr>

                        <!-- Remaining -->
                    <!-- <tr>
                        <th>Cavity Guarantee</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Cavity_Guarantee__c}</td>
                        </template>
                    </tr>
                    
                    
                    <tr>
                        <th>EWI</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.EWI__c}</td>
                        </template>
                    </tr>
                    
                    <tr>
                        <th>Loft Guarantee</th>
                        <template for:each={costingRecords} for:item="record">
                            <td key={record.Id}>{record.Loft_Guarantee__c}</td>
                        </template>
                    </tr> -->
                    
                    
                   
                   
                   
                </tbody>
            </table>
        </div>
        </template>

        <!-- Show error if there is an error -->
        <template if:true={error}>
            <p class="slds-text-color_error">Error: {error.body.message}</p>
        </template>

        <!-- summary field end here -->
                <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_small" 
                        style="border: 2px solid #58D68D; border-radius: 10px; background: linear-gradient(135deg, #E8F8F5 0%, #58D68D 100%);"> 
                    <h3 class="slds-text-heading_medium slds-text-color_success slds-text-align_center" 
                        style="font-size: 2rem; font-weight: bold; color: #1D8348;">
                        <span class="slds-icon_container slds-icon-custom-custom63 slds-m-right_x-small" title="Calculation">
                            <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#calculator"></use>
                            </svg>
                        </span>
                        Costing and Profit Breakdown
                    </h3>
                </div>
                
                <div class="funderDetails">
                <!-- Financial Summary -->
                <div class="slds-grid slds-wrap slds-p-around_small financial-summary">
                    <!-- Funder Average Price -->
                    <div class="slds-col slds-size_1 slds-p-bottom_x-small">
                        <strong>Funder average price:</strong>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <span>{funderAveragePrice}</span>
                    </div>
        
                    <!-- ABS Costing -->
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>ABS Costing:</strong>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <span>{costSavings}</span>
                    </div>
        
                    <!-- Price We Get -->
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>Price We Get:</strong>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <span>{priceWeGet}</span>
                    </div>
        
                    <!-- Total Cost -->
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>Total Cost:</strong>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <span>{totalCost}</span>
                    </div>
        
                    <!-- Profit Amount -->
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <strong>Profit Amount:</strong>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <span>{profitAmount}</span>
                    </div>
        
                    
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <p>Profit Percent :</p>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <!-- Progress bar container -->
                        <div class="progress-container">
                            <!-- Progress bar, style dynamically applied based on percentageClass and percentageWidth -->
                            <div class={percentageClass} style="width: {percentageWidth};">
                                {profitPercentage} %
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- Edit Button (to go back to editable mode) -->
                <div class="slds-box slds-theme_default slds-p-around_medium slds-m-around_medium slds-text-align_right">
                    <lightning-button label="EDIT" variant="brand" class="slds-button_brand slds-m-right_medium" onclick={handleEdit}></lightning-button> 
                </div>
                
                
            </div>
        </lightning-card>
        
    </template>

     <!-- Success message and buttons after saving -->
    <template if:true={isFinish}>
        <lightning-card>
            <div class="slds-box slds-m-around_medium slds-p-around_medium" style="background: linear-gradient(135deg, #ee9d10 0%, #64f38c 100%); border-radius: 12px; padding: 2.5rem; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);">
                <h2 class="slds-text-heading_medium slds-text-align_center" style="color: white; font-weight: bold; font-size: 2.4rem; margin-bottom: 1.5rem;">
                    <svg class="slds-icon slds-icon_medium" aria-hidden="true" style="vertical-align: middle; margin-right: 0.5rem;">
                        <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#check"></use>
                    </svg>
                    Costing Saved Successfully!
                </h2>
                <p class="slds-text-body_regular slds-text-align_center" style="color: #f1f1f1; font-size: 1.5rem;">
                    The costing details have been saved. Please review them and click "Finish" to complete the process.

                </p>
            
                <div class="slds-grid slds-wrap slds-align_absolute-center slds-p-around_medium">
                    <lightning-button label="FINISH" variant="brand" style="background-color: linear-gradient(135deg, #f79d00 0%, #64f38c 100%); font-size: 1.3rem; padding: 1rem 3rem; border-radius: 10px;" onclick={handleFinish}></lightning-button>
                </div>
            </div>
            
            
            
            
            
            
        </lightning-card>
    </template>

    <!-- previosly values -->

    
    <template if:true={isPrevious}>
        <!-- Card for Funder Costing Details -->
        <div class="funderDetails">
        <lightning-card >
            <!-- <div class="slds-box slds-theme_default slds-m-around_medium" style="font-size: 1.8rem; font-weight: bold; color: #333; padding: 20px; background: linear-gradient(135deg, #FDEB71, #F8D800); border-radius: 8px; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);"></div> -->

            <!-- <h1 class="custom-heading" >Funder Costing Details</h1> -->
            <div class="slds-box slds-m-around_medium slds-p-around_medium" style="border: 2px solid #28a745; border-radius: 15px; background: linear-gradient(135deg, #e0f7fa 30%, #a7ffeb 100%); box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);">
                <h3 class="slds-text-heading_medium slds-text-align_center" style="font-weight: bold; color: #00695c; margin-bottom: 1.5rem;">
                    <svg class="slds-icon slds-icon_medium" aria-hidden="true" style="vertical-align: middle; margin-right: 0.5rem;">
                        <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#diamond"></use>
                    </svg>
                    Important Costing Update
                </h3>
                <p class="slds-text-body_regular slds-text-align_center" style="font-size: 1.2rem; color: #004d40;">
                    If you are updating the costing details, make sure to select all the desired values.
                    <br />
                    All the selected values will be updated accordingly.
                </p>
            </div>
            
           
            
            <template if:true={costingDetails}>
                <div class="slds-grid slds-wrap slds-p-around_small">
                    <!-- Normal Bead -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <!-- <strong>Field Name</strong> -->
                        <lightning-input 
                            type="checkbox" 
                            label="Normal Bead" 
                            data-field="Normal_Bead__c" 
                            onchange={handleNormalBeadChange}>
                        </lightning-input>
                    </div>
                
                    <!-- New Value Section -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <!-- <strong>New Value</strong> -->
                        <template if:true={fieldVisibility.Normal_Bead__c}>
                            <span class="field-value">{costingDetails.Normal_Bead__c}</span>
                        </template>
                    </div>
                
                    <!-- Previous Selected Value Section -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <!-- <strong>Previous Selected Value</strong> -->
                        <template if:true={fieldVisibility.Normal_Bead__c}>
                            <span class="field-value">{previousCostingDetails.Normal_Bead__c}</span>
                        </template>
                    </div>
    
                    <!-- Innovation Bead Checkbox, Hide when Normal Bead is checked -->
                    <template if:false={isNormalBeadChecked}>
                        <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                            <lightning-input 
                                type="checkbox" 
                                label="Innovation Bead" 
                                data-field="Innovation_Bead__c" 
                                checked
                onchange={handleInnovationBeadChange}>
                            </lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                            <template if:true={fieldVisibility.Innovation_Bead__c}>
                                <span class="field-value">{costingDetails.Innovation_Bead__c}</span>
                            </template>
                        </div>
                        <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                            <template if:true={fieldVisibility.Innovation_Bead__c}>
                                <span class="field-value">{costingDetails.Innovation_Bead__c}</span>
                            </template>
                        </div>
                       
                    </template>
    
                    <!-- RIR -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="RIR" 
                            data-field="RIR__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.RIR__c}>
                            <span class="field-value">{costingDetails.RIR__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.RIR__c}>
                            <span class="field-value">{costingDetails.RIR__c}</span>
                        </template>
                    </div>
    
                    <!-- Loft -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Loft" 
                            data-field="Loft__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Loft__c}>
                            <span class="field-value">{costingDetails.Loft__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Loft__c}>
                            <span class="field-value">{costingDetails.Loft__c}</span>
                        </template>
                    </div>
    
                    <!-- Mechanical Vents -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Mechanical Vents" 
                            data-field="Mechanical_Vents__c" 
                            onchange={handleMechanicalVentsChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Mechanical_Vents__c}>
                            <lightning-input 
                                type="number" 
                                label="Mechanical Vents Quantity" 
                                value={mechanicalVents} 
                                onchange={handleMechanicalVentsValueChange}>
                            </lightning-input>
                            <strong>Mechanical Vents Cost: {totalMechanicalVentsCost}</strong>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Mechanical_Vents__c}>
                            <lightning-input 
                                type="number" 
                                label="Mechanical Vents Quantity" 
                                value={mechanicalVents} 
                                onchange={handleMechanicalVentsValueChange}>
                            </lightning-input>
                            <strong>Mechanical Vents Cost: {totalMechanicalVentsCost}</strong>
                        </template>
                    </div>
    
                    <!-- EPR Fee -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="EPR Fee" 
                            data-field="EPR_fee__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.EPR_fee__c}>
                            <span class="field-value">{costingDetails.EPR_fee__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.EPR_fee__c}>
                            <span class="field-value">{costingDetails.EPR_fee__c}</span>
                        </template>
                    </div>
    
                    <!-- EPC Elmhurst -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="EPC Elmhurst" 
                            data-field="EPC_Elmhurst__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.EPC_Elmhurst__c}>
                            <span class="field-value">{costingDetails.EPC_Elmhurst__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.EPC_Elmhurst__c}>
                            <span class="field-value">{costingDetails.EPC_Elmhurst__c}</span>
                        </template>
                    </div>
    
                    <!-- TM Lodgement -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="TM Lodgement" 
                            data-field="TM_Lodgement__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.TM_Lodgement__c}>
                            <span class="field-value">{costingDetails.TM_Lodgement__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.TM_Lodgement__c}>
                            <span class="field-value">{costingDetails.TM_Lodgement__c}</span>
                        </template>
                    </div>
    
                    <!-- TM Amendment -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="TM Amendment" 
                            data-field="TM_Amendment__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.TM_Amendment__c}>
                            <span class="field-value">{costingDetails.TM_Amendment__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.TM_Amendment__c}>
                            <span class="field-value">{costingDetails.TM_Amendment__c}</span>
                        </template>
                    </div>
    
                    <!-- Survey Fee -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Survey Fee" 
                            data-field="Survey_Fee__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Survey_Fee__c}>
                            <span class="field-value">{costingDetails.Survey_Fee__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Survey_Fee__c}>
                            <span class="field-value">{costingDetails.Survey_Fee__c}</span>
                        </template>
                    </div>
    
                    <!-- Tech Survey -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Tech Survey" 
                            data-field="Tech_Survey__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Tech_Survey__c}>
                            <span class="field-value">{costingDetails.Tech_Survey__c}</span>
                        </template>
                    </div>
    
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Tech_Survey__c}>
                            <span class="field-value">{costingDetails.Tech_Survey__c}</span>
                        </template>
                    </div>
    
                    <!-- Retrofit Coordination -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Retrofit Coordination" 
                            data-field="Retrofit_Coodintation__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Retrofit_Coodintation__c}>
                            <span class="field-value">{costingDetails.Retrofit_Coodintation__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Retrofit_Coodintation__c}>
                            <span class="field-value">{costingDetails.Retrofit_Coodintation__c}</span>
                        </template>
                    </div>
    
                    <!-- Land Registry -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="Land Registry" 
                            data-field="Land_Registry__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Land_Registry__c}>
                            <span class="field-value">{costingDetails.Land_Registry__c}</span>
                        </template>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <template if:true={fieldVisibility.Land_Registry__c}>
                            <span class="field-value">{costingDetails.Land_Registry__c}</span>
                        </template>
                    </div>
    
                    <!-- CIGA Search -->
                    <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                        <lightning-input 
                            type="checkbox" 
                            label="CIGA Search" 
                            data-field="CIGA_Search__c" 
                            onchange={handleCheckboxChange}>
                        </lightning-input>
                    </div>
                
                <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                    <template if:true={fieldVisibility.CIGA_Search__c}>
                        <span class="field-value">{costingDetails.CIGA_Search__c}</span>
                    </template>
                </div>
                <div class="slds-col slds-size_1-of-3 slds-p-bottom_x-small">
                    <template if:true={fieldVisibility.CIGA_Search__c}>
                        <span class="field-value">{costingDetails.CIGA_Search__c}</span>
                    </template>
                </div>
            </div> 
            </template>
    
            <template if:true={error}>
                <p>Error loading Funder Costing Details</p>
            </template>
        </lightning-card>
    </div>
        <!-- Funder List and Summary Card -->
        <lightning-card >
           
            <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_large" 
            style="border: 2px solid #5DADE2; border-radius: 10px; background: linear-gradient(135deg, #EBF5FB 0%, #AED6F1 100%);"> 
            <div class="slds-grid slds-grid_align-center slds-m-bottom_small">
            <!-- Icon -->
            <div class="slds-icon_container slds-icon-custom-custom63 slds-m-right_x-small" style="color: #2E86C1;">
                <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                    <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#diamond"></use>
                </svg>
            </div>
            <!-- Title -->
            <h2 class="slds-text-heading_medium slds-text-color_default" style="font-size: 2rem; font-weight: bold; color: #1A5276;">
                Funder List
            </h2>
            </div>
            <!-- Content -->
            <p class="slds-text-body_regular" style="font-size: 1.2rem; text-align: center; color: #34495E;">
            Here you can review the list of available funders.
            </p>
            </div>


            <template if:true={funders.length}>
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr class="slds-text-title_caps">
                            <th scope="col">
                                <div class="slds-truncate" title="Funder Name">Funder Name</div>
                            </th>
                            <th scope="col">
                                <div class="slds-truncate" title="Funder Price">Funder Price</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={funders} for:item="funder">
                            <tr key={funder.name}>
                                <td data-label="Funder Name">
                                    <span>{funder.name}</span>
                                </td>
                                <td data-label="Funder Price">
                                    <span>{funder.price}</span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </template>
    
            <template if:false={funders.length}>
                <p>No funders available</p>
            </template>
    
            <!-- Funder Details Section -->

            <div class="slds-box slds-theme_alert-texture slds-m-around_medium slds-p-around_small" 
                    style="border: 2px solid #58D68D; border-radius: 10px; background: linear-gradient(135deg, #E8F8F5 0%, #58D68D 100%);"> 
                <h3 class="slds-text-heading_medium slds-text-color_success slds-text-align_center" 
                    style="font-size: 2rem; font-weight: bold; color: #1D8348;">
                    <span class="slds-icon_container slds-icon-custom-custom63 slds-m-right_x-small" title="Calculation">
                        <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#calculator"></use>
                        </svg>
                    </span>
                    Costing and Profit Breakdown
                </h3>
            </div>


             <div class="funderDetails">
            <div class="slds-grid slds-wrap slds-p-around_small">
                <!-- Funder Average Price -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <strong>Funder average price:</strong>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <span>{funderAveragePrice}</span>
                </div>
    
                <!-- ABS Costing -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <strong>ABS Costing:</strong>
                </div>
                <!-- abs costing -->
    
                <template if:true={showLoading}>
                    <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
                </template>
            
                <template if:true={showError}>
                    <div class="slds-box slds-theme_error">
                        <p>Error loading SAP Band and Cost Savings: {errorMessage}</p>
                        <lightning-button label="Retry" onclick={handleRetry} variant="brand"></lightning-button>
                    </div>
                </template>
            
                <template if:true={showData}>
                    <div class="slds-box slds-p-around_medium" 
                         style="background: linear-gradient(135deg, #FFDEE9, #B5FFFC); border-radius: 15px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); color: #333;">
                        <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                            <strong>Current SAP Band:</strong> {currentSAPBand}
                        </p>
                        <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                            <strong>Potential SAP Band:</strong> {potentialSAPBand}
                        </p>
                        <br>
                        <p style="font-size: 0.9rem; font-weight: bold; text-align: center; color: #333;">
                            <strong>Abs Costing:</strong> {costSavings}
                        </p>
                    </div>
                </template>
                
                
    
                <!-- <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <span>{costSavings}</span>
                </div> -->
    
                <!-- Profit Bar -->
                <hr>
    
                <!-- Price We Get -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <strong>Price We Get:</strong>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <span>{priceWeGet}</span>
                </div>
    
                <!-- Total Cost -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <strong>Total Cost:</strong>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <span>{totalCost}</span>
                </div>
    
                <!-- Profit Amount -->
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <strong>Profit Amount:</strong>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                    <span>{profitAmount}</span>
                </div>
    
               
                <!-- update percentage bar -->
    
                
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <p>Profit Percent :</p>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-bottom_x-small">
                        <!-- Progress bar container -->
                        <div class="progress-container">
                            <!-- Progress bar, style dynamically applied based on percentageClass and percentageWidth -->
                            <div class={percentageClass} style="width: {percentageWidth};">
                                {profitPercentage} %
                            </div>
                        </div>
                    </div>
                
    
            </div>
        </div>
            <!-- <div class="slds-col slds-size_1-of-1 slds-p-bottom_x-small">
                <div class="profit-bar" style="width: {profitBarWidth}; background-color: {profitBarColor}; height: 20px;"></div>
            </div> -->
            
            
            
    
            <!-- Save and Previous Buttons -->
             <div class="funderButton">
                <lightning-card class="slds-p-around_medium slds-m-around_medium" style="background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);">
                    <div class="slds-grid slds-grid_align-end">
                        <lightning-button label="SAVE" variant="brand" style="font-size: 1.3rem; padding: 1rem 2.5rem; background-color: white; color: #a6c1ee; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);" onclick={handleSave}></lightning-button>
                    </div>
                </lightning-card>
                
   
    </div>
    
 
        </lightning-card>
    </template>


</template>


